<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Data Navigator</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Use the Inter font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* A light gray background */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        
        /* Style for table headers to make them sticky and sortable */
        thead th {
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
        }
        thead th:hover {
            background-color: #e5e7eb; /* Slightly darker on hover */
        }
        /* Styles for sorting indicators */
        .sort-asc::after {
            content: ' ▲';
            font-size: 0.8em;
        }
        .sort-desc::after {
            content: ' ▼';
            font-size: 0.8em;
        }

        /* Loading Spinner Animation */
        .loader {
            border: 5px solid #f3f3f3;
            border-radius: 50%;
            border-top: 5px solid #4f46e5;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Sports Data Dashboard</h1>
            <p class="text-md text-gray-600 mt-1">Analyze betting data with powerful filters and sorting.</p>
        </header>

        <!-- Analytics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-md flex items-center">
                <div class="bg-indigo-100 rounded-full p-3 mr-4">
                    <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Total Matches</p>
                    <p id="totalMatches" class="text-2xl font-bold text-gray-900">-</p>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-md flex items-center">
                <div class="bg-green-100 rounded-full p-3 mr-4">
                     <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Win Rate</p>
                    <p id="winRate" class="text-2xl font-bold text-gray-900">-</p>
                </div>
            </div>
             <div class="bg-white p-6 rounded-xl shadow-md flex items-center">
                <div class="bg-yellow-100 rounded-full p-3 mr-4">
                     <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Avg. Total Goals</p>
                    <p id="avgGoals" class="text-2xl font-bold text-gray-900">-</p>
                </div>
            </div>
             <div class="bg-white p-6 rounded-xl shadow-md lg:col-span-2">
                <div class="flex items-start">
                    <div class="bg-blue-100 rounded-full p-3 mr-4">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Top 5 Best Chances (by Confidence)</p>
                        <div id="topChances" class="mt-2 text-sm text-gray-900">
                             <p class="text-gray-400">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 items-end">
                <!-- Search Filter -->
                <div class="lg:col-span-2">
                    <label for="searchFilter" class="block text-sm font-medium text-gray-700 mb-2">Search Team</label>
                    <input type="text" id="searchFilter" placeholder="Enter team name..." class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition">
                </div>
                <!-- Date Filters -->
                <div>
                     <label for="startDate" class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                     <input type="date" id="startDate" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition">
                </div>
                 <div>
                     <label for="endDate" class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                     <input type="date" id="endDate" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition">
                </div>
                <!-- Dropdown Filters -->
                <div>
                    <label for="chanceFilter" class="block text-sm font-medium text-gray-700 mb-2">Filter by Chance</label>
                    <select id="chanceFilter" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition">
                        <option value="All">All Chances</option>
                    </select>
                </div>
                <div>
                    <label for="winningMarginFilter" class="block text-sm font-medium text-gray-700 mb-2">Winning Margin Met</label>
                    <select id="winningMarginFilter" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 transition">
                        <option value="All">All</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                 <!-- Reset Button -->
                <div class="sm:col-span-2 md:col-span-3 lg:col-span-6 flex justify-end mt-4">
                     <button id="resetFilters" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-6 rounded-lg transition duration-300 ease-in-out flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5M4 4l5 5M20 20l-5-5"></path></svg>
                        Reset Filters
                    </button>
                </div>
            </div>
        </div>

        <!-- Data Table Section -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
            <div id="table-container" class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <!-- Table headers will be populated by JavaScript -->
                        </tr>
                    </thead>
                    <tbody id="dataTableBody" class="bg-white divide-y divide-gray-200">
                         <tr><td colspan="16" class="p-8 text-center text-gray-500"><div class="loader mx-auto"></div><p class="mt-4">Loading data...</p></td></tr>
                    </tbody>
                </table>
                 <div id="no-results" class="hidden p-8 text-center text-gray-500">
                    No records match the current filters.
                </div>
            </div>
        </div>
        
        <footer class="text-center mt-8 text-sm text-gray-500">
            <p>Powered by Google Sheets & Tailwind CSS</p>
        </footer>
    </div>

    <script>
        // --- CONFIGURATION ---
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/1iTAOTu1GcuGbkmxHayZWqbjG9Y0sxGf2x6_PgS0TDRo/export?format=csv&gid=337419731'; // <--- PASTE YOUR URL HERE

        // --- DOM ELEMENT REFERENCES ---
        const tableBody = document.getElementById('dataTableBody');
        const tableHeader = document.querySelector('thead tr');
        const noResultsDiv = document.getElementById('no-results');
        
        // Filters
        const searchFilter = document.getElementById('searchFilter');
        const startDateFilter = document.getElementById('startDate');
        const endDateFilter = document.getElementById('endDate');
        const chanceFilter = document.getElementById('chanceFilter');
        const winningMarginFilter = document.getElementById('winningMarginFilter');
        const resetFiltersBtn = document.getElementById('resetFilters');

        // Analytics Cards
        const totalMatchesCard = document.getElementById('totalMatches');
        const winRateCard = document.getElementById('winRate');
        const avgGoalsCard = document.getElementById('avgGoals');
        const topChancesCard = document.getElementById('topChances');
        
        let allData = [];
        let headers = [];
        let sortState = { column: null, direction: 'asc' };

        // --- CORE FUNCTIONS ---

        async function init() {
            try {
                const response = await fetch(GOOGLE_SHEET_URL);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                
                const csvText = await response.text();
                const parsed = parseCSV(csvText);
                headers = parsed.headers;
                allData = parsed.data;
                
                renderHeaders();
                populateChanceFilter(headers.indexOf('Chance'));
                applyFiltersAndRender();

            } catch (error) {
                console.error('Failed to fetch or process data:', error);
                tableBody.innerHTML = `<tr><td colspan="${headers.length + 1 || 16}" class="p-8 text-center text-red-500 font-semibold">Failed to load data. Please check the Google Sheet URL and ensure it's published correctly.</td></tr>`;
            }
        }

        function parseCSV(text) {
            const rows = text.split(/\r?\n/).map(row => row.split(','));
            const headerRow = rows.shift() || [];
            const data = rows.filter(row => row.length === headerRow.length);
            return { headers: headerRow, data };
        }

        function renderHeaders() {
            tableHeader.innerHTML = headers.map((header, index) => {
                let classes = 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider';
                if (sortState.column === index) {
                    classes += sortState.direction === 'asc' ? ' sort-asc' : ' sort-desc';
                }
                return `<th scope="col" data-index="${index}" class="${classes}">${header.replace(/_/g, ' ')}</th>`;
            }).join('') + '<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Match Outcome</th>';
        }
        
        function populateChanceFilter(chanceIndex) {
            if (chanceIndex === -1) return;
            const chances = [...new Set(allData.map(row => row[chanceIndex]).filter(Boolean))];
            chances.sort();
            chances.forEach(chance => {
                const option = document.createElement('option');
                option.value = chance;
                option.textContent = chance;
                chanceFilter.appendChild(option);
            });
        }

        function applyFiltersAndRender() {
            // 1. Filter Data
            const chanceValue = chanceFilter.value;
            const winningMarginValue = winningMarginFilter.value;
            const searchValue = searchFilter.value.toLowerCase();
            const startDate = startDateFilter.value ? new Date(startDateFilter.value) : null;
            const endDate = endDateFilter.value ? new Date(endDateFilter.value) : null;
            if(startDate) startDate.setHours(0,0,0,0);
            if(endDate) endDate.setHours(23,59,59,999);

            const dateIndex = headers.indexOf('Date');
            const homeTeamIndex = headers.indexOf('Home Team');
            const awayTeamIndex = headers.indexOf('Away Team');
            const chanceIndex = headers.indexOf('Chance');
            const winningMarginIndex = headers.indexOf('Winning Margin Met');
            
            const filteredData = allData.filter(row => {
                const chanceMatch = (chanceValue === 'All') || (row[chanceIndex] === chanceValue);
                const winningMarginMatch = (winningMarginValue === 'All') || (row[winningMarginIndex] === winningMarginValue);
                const searchMatch = !searchValue || row[homeTeamIndex].toLowerCase().includes(searchValue) || row[awayTeamIndex].toLowerCase().includes(searchValue);
                const dateMatch = (!startDate || new Date(row[dateIndex]) >= startDate) && (!endDate || new Date(row[dateIndex]) <= endDate);

                return chanceMatch && winningMarginMatch && searchMatch && dateMatch;
            });

            // 2. Sort Data
            if (sortState.column !== null) {
                filteredData.sort((a, b) => {
                    let valA = a[sortState.column];
                    let valB = b[sortState.column];

                    // Simple numeric sort for potential number columns
                    if (!isNaN(valA) && !isNaN(valB) && valA.trim() !== '' && valB.trim() !== '') {
                        return sortState.direction === 'asc' ? valA - valB : valB - valA;
                    }
                    
                    // Locale-aware string comparison
                    return sortState.direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
                });
            }

            // 3. Render and Update Analytics
            renderTable(filteredData);
            updateAnalytics(filteredData);
        }

        function renderTable(data) {
            tableBody.innerHTML = '';
            noResultsDiv.classList.toggle('hidden', data.length > 0);

            if (data.length === 0) return;
            
            const chanceIndex = headers.indexOf('Chance');
            const winningMarginIndex = headers.indexOf('Winning Margin Met');
            const homeTeamIndex = headers.indexOf('Home Team');
            const awayTeamIndex = headers.indexOf('Away Team');

            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50 transition-colors duration-200';
                
                let cells = row.map((cell, index) => {
                    let cellClass = 'px-6 py-4 whitespace-nowrap text-sm text-gray-700';
                    let cellContent = cell || '-';

                    if (index === chanceIndex) {
                        const chanceValue = cell.toLowerCase();
                        if (chanceValue === 'high') cellClass += ' font-bold text-green-600';
                        else if (chanceValue === 'medium') cellClass += ' font-semibold text-yellow-600';
                        else if (chanceValue === 'low') cellClass += ' text-red-600';
                    } else if (index === winningMarginIndex) {
                         const marginMet = cell.toLowerCase();
                         if (marginMet === 'yes') cellContent = `<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">${cell}</span>`;
                         else if (marginMet === 'no') cellContent = `<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">${cell}</span>`;
                    }
                    return `<td class="${cellClass}">${cellContent}</td>`;
                }).join('');

                const homeTeam = row[homeTeamIndex] || '';
                const awayTeam = row[awayTeamIndex] || '';
                const outcomeCell = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                        <button class="fetch-outcome-btn bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-1 px-3 rounded-md text-xs transition" 
                                data-hometeam="${homeTeam.replace(/"/g, '&quot;')}" 
                                data-awayteam="${awayTeam.replace(/"/g, '&quot;')}">
                            Fetch
                        </button>
                    </td>
                `;

                tr.innerHTML = cells + outcomeCell;
                tableBody.appendChild(tr);
            });
        }

        function updateAnalytics(data) {
            totalMatchesCard.textContent = data.length;

            const winningMarginIndex = headers.indexOf('Winning Margin Met');
            const totalGoalsIndex = headers.indexOf('Total Goals');

            if(data.length > 0) {
                const wins = data.filter(row => row[winningMarginIndex]?.toLowerCase() === 'yes').length;
                winRateCard.textContent = `${((wins / data.length) * 100).toFixed(1)}%`;

                const totalGoals = data.reduce((acc, row) => acc + (parseFloat(row[totalGoalsIndex]) || 0), 0);
                avgGoalsCard.textContent = (totalGoals / data.length).toFixed(2);
            } else {
                winRateCard.textContent = 'N/A';
                avgGoalsCard.textContent = 'N/A';
            }

            updateTopChances(data);
        }

        function updateTopChances(data) {
            const homeTeamIndex = headers.indexOf('Home Team');
            const awayTeamIndex = headers.indexOf('Away Team');
            const confidenceIndex = headers.indexOf('Confidence');

            if (confidenceIndex === -1 || homeTeamIndex === -1 || awayTeamIndex === -1) {
                topChancesCard.innerHTML = '<p class="text-gray-400 text-xs">Required columns not found for this feature.</p>';
                return;
            }

            const sortedByConfidence = [...data]
                .sort((a, b) => {
                    const confidenceA = parseFloat(a[confidenceIndex]) || 0;
                    const confidenceB = parseFloat(b[confidenceIndex]) || 0;
                    return confidenceB - confidenceA;
                })
                .slice(0, 5);

            if (sortedByConfidence.length === 0) {
                topChancesCard.innerHTML = '<p class="text-gray-400">No matches to display.</p>';
                return;
            }

            topChancesCard.innerHTML = `
                <ol class="list-decimal list-inside space-y-1">
                    ${sortedByConfidence.map(row => `
                        <li>
                            <span class="font-semibold">${row[homeTeamIndex]}</span> vs <span class="font-semibold">${row[awayTeamIndex]}</span>
                            <span class="text-indigo-600 font-bold ml-2">${(parseFloat(row[confidenceIndex]) || 0).toFixed(0)}%</span>
                        </li>
                    `).join('')}
                </ol>
            `;
        }
        
        /**
         * Simulates fetching a live match outcome.
         * In a real-world app, this would be an API call to a sports data provider.
         */
        async function fetchMatchOutcome(homeTeam, awayTeam, buttonElement) {
            buttonElement.disabled = true;
            buttonElement.innerHTML = `<svg class="animate-spin h-4 w-4 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;

            // --- SIMULATION ---
            // TODO: Replace this setTimeout with a real `fetch` call to a sports API.
            // Example: const response = await fetch(`https://api.yoursportsdata.com/v1/matches?home=${homeTeam}&away=${awayTeam}&apiKey=YOUR_KEY`);
            // const data = await response.json();
            // const result = data.score; // e.g., "2 - 1"
            await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate network delay

            const homeScore = Math.floor(Math.random() * 4);
            const awayScore = Math.floor(Math.random() * 4);
            const result = `${homeScore} - ${awayScore}`;
            // --- END SIMULATION ---
            
            const parentTd = buttonElement.parentElement;
            if (parentTd) {
                parentTd.innerHTML = `<span class="font-bold text-gray-800">${result}</span>`;
            }
        }

        function handleSort(e) {
            const target = e.target.closest('th');
            if (!target || !target.dataset.index) return; // Ignore clicks on the non-sortable outcome header

            const columnIndex = parseInt(target.dataset.index);

            if (sortState.column === columnIndex) {
                sortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';
            } else {
                sortState.column = columnIndex;
                sortState.direction = 'asc';
            }

            renderHeaders(); // Re-render headers to show sort indicator
            applyFiltersAndRender();
        }

        function resetFilters() {
            searchFilter.value = '';
            startDateFilter.value = '';
            endDateFilter.value = '';
            chanceFilter.value = 'All';
            winningMarginFilter.value = 'All';
            sortState = { column: null, direction: 'asc' };
            renderHeaders();
            applyFiltersAndRender();
        }

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', init);
        tableHeader.addEventListener('click', handleSort);
        resetFiltersBtn.addEventListener('click', resetFilters);

        // Event delegation for fetch buttons
        tableBody.addEventListener('click', e => {
            if (e.target && e.target.classList.contains('fetch-outcome-btn')) {
                const button = e.target;
                const homeTeam = button.dataset.hometeam;
                const awayTeam = button.dataset.awayteam;
                fetchMatchOutcome(homeTeam, awayTeam, button);
            }
        });

        [searchFilter, startDateFilter, endDateFilter, chanceFilter, winningMarginFilter].forEach(el => {
            el.addEventListener('input', applyFiltersAndRender); // 'input' for instant search feedback
            el.addEventListener('change', applyFiltersAndRender); // 'change' for selects and date pickers
        });
    </script>
</body>
</html>

